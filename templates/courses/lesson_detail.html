{% extends "base.html" %}
{% load static %}

{% block title %}Lesson Details{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'lessons/lesson-details.css' %}">

<div class="lesson-details-header">
    <div class="lessons-title-section">
        <div class="lessons-title">
            <div class="lesson-icon">
                <i class='bx bx-book-open'></i>
            </div>
            Lesson Details
        </div>
        <div class="header-actions">
            {% if request.user == object.course.instructor %}
                <a class="action-btn edit-btn" href="{% url 'lesson_edit' object.id %}"><i class='bx bx-edit'></i> Edit</a>
                <form method="post" action="{% url 'lesson_delete' object.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button class="action-btn delete-btn" type="submit"><i class='bx bx-trash'></i> Delete</button>
                </form>
            {% endif %}
            <a class="back-btn" href="{% url 'course_detail' object.course.id %}"><i class='bx bx-left-arrow-alt'></i> Back to Lessons</a>
        </div>
    </div>
    </div>

<div class="lesson-details-container">
    <div class="lesson-header">
        <h1>{{ object.title }}</h1>
        {% if object.lesson_code %}<span class="lesson-id">Lesson ID: {{ object.lesson_code }}</span>{% endif %}
    </div>

    {% if object.description %}<p class="lesson-full-description">{{ object.description }}</p>{% endif %}

    {% if objectives_list %}
    <div class="lesson-section">
        <h2><i class='bx bx-target-lock'></i> Objectives</h2>
        <ul class="normal-list">{% for item in objectives_list %}<li>{{ item }}</li>{% endfor %}</ul>
    </div>
    {% endif %}

    {% if reading_list %}
    <div class="lesson-section">
        <h2><i class='bx bx-book-reader'></i> Reading List</h2>
        <ul class="styled-list">
        {% for item in reading_list %}
            {% if item.url %}<li><a href="{{ item.url }}" target="_blank">{{ item.text }}</a></li>{% else %}<li>{{ item.text }}</li>{% endif %}
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="lesson-section">
        <h2><i class='bx bx-list-check'></i> Prerequisites</h2>
        {% with prereqs=object.prerequisites.all %}
            {% if prereqs %}
                {% for l in prereqs %}<span class="prerequisite-tag">{{ l.title }}</span>{% empty %}<span class="prerequisite-tag">None</span>{% endfor %}
            {% else %}
                <span class="prerequisite-tag">None</span>
            {% endif %}
        {% endwith %}
    </div>

    {% if assignments_list %}
    <div class="lesson-section">
        <h2><i class='bx bx-clipboard'></i> Assignments</h2>
        <ul class="normal-list">{% for a in assignments_list %}<li>{{ a }}</li>{% endfor %}</ul>
    </div>
    {% endif %}

    {% if classroom_schedules %}
    <div class="lesson-section">
        <h2><i class='bx bx-chalkboard'></i> Classroom Schedule</h2>
        <div class="classroom-schedule">
            {% for schedule in classroom_schedules %}
            <a href="{% url 'classroom_preview' schedule.classroom_id %}" class="classroom-session">
                <p><i class='bx bx-buildings'></i> Classroom: <strong>{{ schedule.classroom.name }}</strong></p>
                <p><i class='bx bx-time-five'></i> Time: <strong>{{ schedule.get_day_display }} {{ schedule.start_time|time:'g:i A' }} - {{ schedule.end_time|time:'g:i A' }}</strong></p>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="lesson-meta">
        {% if object.duration_hours %}<div class="meta-item"><i class='bx bx-time'></i> Duration: {{ object.duration_hours }} hours</div>{% endif %}
        {% if object.credit_points %}<div class="meta-item"><i class='bx bx-medal'></i> Credits: {{ object.credit_points }}</div>{% endif %}
        {% if object.instructor %}<div class="meta-item"><i class='bx bx-user'></i> Instructor: {{ object.instructor.get_full_name|default:object.instructor.email }}</div>{% endif %}
        <div class="meta-item"><i class='bx bx-calendar'></i> Created: {{ object.created_at|date:"d/m/Y" }}</div>
        <div class="meta-item"><i class='bx bx-calendar-edit'></i> Updated: {{ object.updated_at|date:"d/m/Y" }}</div>
    </div>

    
</div>
{% endblock %}
